# Surface Area Analysis

This script analyses hemisphere wide surface area 


```r
#load libraries
library(tidyverse)
library(broom)
library(lmerTest)
```


```r
#bring in data 
df <- read_csv('../generated_csvs/STOPPD_participantsCT_20181111.csv') #generated by 05_STOPPD_error in prepartion of Jason Lerch meeting

RandomArmColors = c( "#FFC200", "#007aa3")
```



```r
#make sure that STUDYID is an interger not a number
  df$STUDYID <- as.character(df$STUDYID)

#make sure that dateDiff is a number, not an interger
  df$dateDiff <- as.numeric(df$dateDiff)

# label the randomization variable  
df$RandomArm <- factor(df$randomization, 
                       levels = c("O", "P"),
                       labels = c("Olanzapine", "Placebo"))

#restructure data for RCT completers' only (N=40)
  RCT_SA <- df %>%
    filter(category == "RCT") 

#write out clean dataframe
 # write.csv(RCT_CT, '../generated_data/df_leftCT.csv', row.names=FALSE)
```



## RCT only



```r
RCT_SA %>% count(RandomArm) %>% knitr::kable() 
```


\begin{tabular}{l|r}
\hline
RandomArm & n\\
\hline
Olanzapine & 26\\
\hline
Placebo & 14\\
\hline
\end{tabular}


```r
fit_all <- lmer(LSurfArea_change ~ RandomArm + sex + age + (1|site), data= RCT_SA)
summary(fit_all)
```

```
## Linear mixed model fit by REML. t-tests use Satterthwaite's method [
## lmerModLmerTest]
## Formula: LSurfArea_change ~ RandomArm + sex + age + (1 | site)
##    Data: RCT_SA
## 
## REML criterion at convergence: 564.7
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.0838 -0.5189  0.1080  0.6790  2.0453 
## 
## Random effects:
##  Groups   Name        Variance  Std.Dev. 
##  site     (Intercept) 5.515e-09 7.426e-05
##  Residual             2.363e+05 4.861e+02
## Number of obs: 40, groups:  site, 4
## 
## Fixed effects:
##                  Estimate Std. Error     df t value Pr(>|t|)   
## (Intercept)        525.53     305.14  36.00   1.722  0.09360 . 
## RandomArmPlacebo   477.83     163.94  36.00   2.915  0.00609 **
## sexM               -37.09     157.81  36.00  -0.235  0.81551   
## age                -15.79       5.66  36.00  -2.791  0.00836 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##             (Intr) RndmAP sexM  
## RndmArmPlcb -0.022              
## sexM        -0.044  0.067       
## age         -0.921 -0.181 -0.201
```



### Right Surface Area Model


```r
fit_all <- lmer(RSurfArea_change ~ RandomArm + sex + age + (1|site), data= RCT_SA)
summary(fit_all)
```

```
## Linear mixed model fit by REML. t-tests use Satterthwaite's method [
## lmerModLmerTest]
## Formula: RSurfArea_change ~ RandomArm + sex + age + (1 | site)
##    Data: RCT_SA
## 
## REML criterion at convergence: 576.2
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -2.0486 -0.7543 -0.1248  0.6839  2.5139 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  site     (Intercept)      0     0.0   
##  Residual             325363   570.4   
## Number of obs: 40, groups:  site, 4
## 
## Fixed effects:
##                  Estimate Std. Error      df t value Pr(>|t|)
## (Intercept)       205.920    358.036  36.000   0.575    0.569
## RandomArmPlacebo  143.174    192.356  36.000   0.744    0.462
## sexM              153.063    185.168  36.000   0.827    0.414
## age                -9.417      6.641  36.000  -1.418    0.165
## 
## Correlation of Fixed Effects:
##             (Intr) RndmAP sexM  
## RndmArmPlcb -0.022              
## sexM        -0.044  0.067       
## age         -0.921 -0.181 -0.201
```


```r
#boxplot of difference in thickness (y axis) by randomization group (x axis)
RCT_SA %>%
  gather(TCT, mm, LSurfArea_change, RSurfArea_change) %>%
  mutate(ThickChange = factor(TCT, levels = c("LSurfArea_change", "RSurfArea_change"),
                              labels = c("Left Hemisphere", "Right Hemisphere"))) %>%
ggplot(aes(x= RandomArm, y = mm, fill = RandomArm)) + 
     geom_boxplot(outlier.shape = NA, alpha = 0.0001) + 
     geom_dotplot(binaxis = 'y', stackdir = 'center', binwidth = 100) +
     geom_hline(yintercept = 0) +
     labs(x = NULL, y = "Change in Cortical Surface Area") +
     scale_fill_manual(values = RandomArmColors) +
     scale_shape_manual(values = c(21)) +
     facet_wrap(~ ThickChange) +
     theme_bw()
```

![](07_STOPPD_CorticalSurfaceArea_byhemi_files/figure-latex/RCT_SA_facet_boxplot_fig2B-1.pdf)<!-- --> 



## Plots and one sampled ttest in all participants


```r
df %>%
  gather(TCT, mm, LSurfArea_change, RSurfArea_change) %>%
  mutate(SurfAreaChange = factor(TCT, levels = c("LSurfArea_change", "RSurfArea_change"),
                              labels = c("Left Hemisphere", "Right Hemisphere")),
         Outcome = case_when(category == "Off protocol" ~ "non-completer",
                             category == "Relapse" ~ "non-completer",
                             category == "RCT"~ "completer")) %>%
  ggplot(aes(x= RandomArm, y = mm, fill = Outcome)) + 
     geom_boxplot(outlier.shape = NA) + 
     geom_dotplot(binaxis = 'y', stackdir = 'center', 
                  position=position_dodge(0.8), binwidth = 75) +
     geom_hline(yintercept = 0) +
     xlab(NULL) +
     ylab("Change in Cortical Thickness (mm)") +
     theme_bw() +
     scale_fill_manual(values = c('white','grey')) +
     facet_wrap(~SurfAreaChange)
```

![](07_STOPPD_CorticalSurfaceArea_byhemi_files/figure-latex/unnamed-chunk-3-1.pdf)<!-- --> 

```r
df %>%
  gather(TCT, mm, LSurfArea_change, RSurfArea_change) %>%
  mutate(SurfAreaChange = factor(TCT, levels = c("LSurfArea_change", "RSurfArea_change"),
                              labels = c("Left Hemisphere", "Right Hemisphere")),
         Outcome = case_when(category == "Off protocol" ~ "non-completer",
                             category == "Relapse" ~ "non-completer",
                             category == "RCT"~ "completer")) %>%
  group_by(SurfAreaChange, category) %>%
  do(tidy(t.test(.$mm, mu = 0, alternative = "two.sided"))) %>%
  knitr::kable()
```


\begin{tabular}{l|l|r|r|r|r|r|r|l|l}
\hline
SurfAreaChange & category & estimate & statistic & p.value & parameter & conf.low & conf.high & method & alternative\\
\hline
Left Hemisphere & Off protocol & -4.3400 & -0.0194916 & 0.9853825 & 4 & -622.5438 & 613.8637597 & One Sample t-test & two.sided\\
\hline
Left Hemisphere & RCT & -176.8300 & -2.0199766 & 0.0502934 & 39 & -353.8976 & 0.2376122 & One Sample t-test & two.sided\\
\hline
Left Hemisphere & Relapse & -310.8519 & -2.7173890 & 0.0115513 & 26 & -545.9912 & -75.7124877 & One Sample t-test & two.sided\\
\hline
Right Hemisphere & Off protocol & -206.6400 & -0.8364687 & 0.4499511 & 4 & -892.5289 & 479.2489135 & One Sample t-test & two.sided\\
\hline
Right Hemisphere & RCT & -183.5925 & -2.0476152 & 0.0473750 & 39 & -364.9502 & -2.2347509 & One Sample t-test & two.sided\\
\hline
Right Hemisphere & Relapse & -343.8444 & -2.4151973 & 0.0230569 & 26 & -636.4840 & -51.2048411 & One Sample t-test & two.sided\\
\hline
\end{tabular}

## RCT & Relapse (with time as factor)



```r
#restructure data for RCT & Relapse participants (N=72)
  RCTRelapse_LSA <- df %>%
    gather(oldcolname, SurfArea, LSurfArea_01, LSurfArea_02) %>%
    mutate(model_days = if_else(oldcolname == "LSurfArea_01", 1, dateDiff)) %>%
mutate(category = factor(category, levels = c("RCT","Relapse", "Off protocol")),
           hemi = "Left Hemisphere")

RCTRelapse_LSA %>% filter(model_days == 1) %>% count(RandomArm) %>% knitr::kable() 
```


\begin{tabular}{l|r}
\hline
RandomArm & n\\
\hline
Olanzapine & 38\\
\hline
Placebo & 34\\
\hline
\end{tabular}


```r
#plot all data, including outlier (participant 210030)
RCTRelapse_LSA %>%
  mutate(hemi = "Left Hemisphere") %>%
  ggplot(aes(x=model_days, y=SurfArea, fill = RandomArm)) + 
  geom_point(aes(shape = category)) + 
  geom_line(aes(group=STUDYID, color = RandomArm), alpha = 0.5) + 
  geom_smooth(aes(color = RandomArm), method="lm") +
  xlab("Days between MRIs") +  
  ylab("Surface Area") +
  scale_colour_manual(values = RandomArmColors) +
  scale_fill_manual(values = RandomArmColors) +
  scale_shape_manual(values = c(21:23)) +
  scale_y_continuous(limits = c(59000,115000)) +
  theme_bw()  +
  facet_wrap(~hemi)
```

![](07_STOPPD_CorticalSurfaceArea_byhemi_files/figure-latex/RCTRelapse_LSA_plot_fig2DL-1.pdf)<!-- --> 




```r
#run mixed linear model, with covariates
  fit_all <- lmer(SurfArea ~ RandomArm*model_days + sex + age + (1|site) + (1|STUDYID), data= RCTRelapse_LSA)
  summary(fit_all)
```

```
## Linear mixed model fit by REML. t-tests use Satterthwaite's method [
## lmerModLmerTest]
## Formula: SurfArea ~ RandomArm * model_days + sex + age + (1 | site) +  
##     (1 | STUDYID)
##    Data: RCTRelapse_LSA
## 
## REML criterion at convergence: 2542.5
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -2.94832 -0.46341 -0.00847  0.45821  2.93101 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  STUDYID  (Intercept) 52815526 7267.4  
##  site     (Intercept) 12067533 3473.8  
##  Residual               163892  404.8  
## Number of obs: 144, groups:  STUDYID, 72; site, 4
## 
## Fixed effects:
##                               Estimate Std. Error         df t value
## (Intercept)                 85136.6299  3810.0342    29.2781  22.345
## RandomArmPlacebo            -2027.5553  1741.6216    65.5546  -1.164
## model_days                     -1.2901     0.4267    70.0217  -3.023
## sexM                        11090.3955  1745.4287    65.4625   6.354
## age                          -114.7242    56.7060    65.1570  -2.023
## RandomArmPlacebo:model_days     1.2395     0.7210    70.0556   1.719
##                             Pr(>|t|)    
## (Intercept)                  < 2e-16 ***
## RandomArmPlacebo             0.24857    
## model_days                   0.00349 ** 
## sexM                        2.31e-08 ***
## age                          0.04717 *  
## RandomArmPlacebo:model_days  0.09002 .  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##             (Intr) RndmAP mdl_dy sexM   age   
## RndmArmPlcb -0.182                            
## model_days  -0.013  0.025                     
## sexM        -0.168  0.053  0.000              
## age         -0.796 -0.064  0.002 -0.077       
## RndmArmPl:_  0.007 -0.034 -0.592  0.001 -0.001
```

### Running the right hemisphere RCTRelapse



```r
#restructure data for RCT & Relapse participants (N=72)
  RCTRelapse_RSA <- df %>%
    gather(oldcolname, SurfArea, RSurfArea_01, RSurfArea_02) %>%
    mutate(model_days = if_else(oldcolname == "RSurfArea_01", 1, dateDiff)) %>%
    mutate(category = factor(category, levels = c("RCT","Relapse", "Off protocol")),
           hemi = "Right Hemisphere")
    

#plot all data, including outlier (participant 210030)
RCTRelapse_RSA %>%
  ggplot(aes(x=model_days, y=SurfArea, fill = RandomArm)) + 
  geom_point(aes(shape = category)) + 
  geom_line(aes(group=STUDYID, color = RandomArm), alpha = 0.5) + 
  geom_smooth(aes(color = RandomArm), method="lm", formula=y~poly(x,1)) +
  xlab("Days between MRIs") +  
  ylab("Surface Area") +
  scale_colour_manual(values = RandomArmColors) +
  scale_fill_manual(values = RandomArmColors) +
  scale_shape_manual(values = c(21:23)) +
  scale_y_continuous(limits = c(59000,115000)) +
  theme_bw()  +
  facet_wrap(~hemi)
```

![](07_STOPPD_CorticalSurfaceArea_byhemi_files/figure-latex/RCTRelapse_RSA_plot_fig2DR-1.pdf)<!-- --> 




```r
#run mixed linear model, with covariates
  fit_all <- lmer(SurfArea ~ RandomArm*model_days + sex + age + (1|site) + (1|STUDYID), data= RCTRelapse_RSA)
  summary(fit_all)
```

```
## Linear mixed model fit by REML. t-tests use Satterthwaite's method [
## lmerModLmerTest]
## Formula: SurfArea ~ RandomArm * model_days + sex + age + (1 | site) +  
##     (1 | STUDYID)
##    Data: RCTRelapse_RSA
## 
## REML criterion at convergence: 2563.2
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -3.12738 -0.35173  0.00122  0.37935  3.09897 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  STUDYID  (Intercept) 54382971 7374.5  
##  site     (Intercept) 11216454 3349.1  
##  Residual               214731  463.4  
## Number of obs: 144, groups:  STUDYID, 72; site, 4
## 
## Fixed effects:
##                               Estimate Std. Error         df t value
## (Intercept)                 84685.7396  3826.6624    31.4280  22.130
## RandomArmPlacebo            -1348.4060  1767.5776    65.6422  -0.763
## model_days                     -1.0748     0.4884    70.0280  -2.201
## sexM                        11087.7051  1771.1232    65.5082   6.260
## age                          -112.9806    57.5465    65.1767  -1.963
## RandomArmPlacebo:model_days     0.3040     0.8253    70.0711   0.368
##                             Pr(>|t|)    
## (Intercept)                  < 2e-16 ***
## RandomArmPlacebo              0.4483    
## model_days                    0.0311 *  
## sexM                        3.35e-08 ***
## age                           0.0539 .  
## RandomArmPlacebo:model_days   0.7137    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##             (Intr) RndmAP mdl_dy sexM   age   
## RndmArmPlcb -0.184                            
## model_days  -0.015  0.028                     
## sexM        -0.170  0.052  0.000              
## age         -0.804 -0.064  0.002 -0.077       
## RndmArmPl:_  0.008 -0.038 -0.592  0.001 -0.001
```




