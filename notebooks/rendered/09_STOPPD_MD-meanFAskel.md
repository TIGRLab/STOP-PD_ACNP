# Whole Skeleton Mean Diffusivity



```r
#load libraries
library(tidyverse)
library(lme4)
library(lmerTest)
library(growthmodels)
```


```r
#bring in subject info (generated by 03_STOPPD_masterDF.Rmd)
# then take only the subjects who completed (n= 72 - note two were excluded for IF)
df <- read_csv('../generated_csvs/STOPPD_masterDF_2018-11-05.csv') %>%
  mutate(STUDYID = as.character(STUDYID)) %>%
  filter(second_complete == "Yes", MR_exclusion == "No") 

#rename timepoint variable for clarity
colnames(df)[colnames(df)=="second_timepoint"] <- "category" 

#make a datediff column for time between scans
df$dateDiff <- as.numeric(round(difftime(df$second_date, df$first_date, units = "days"), 0))
```
## Known exclusion reasons

#### known DWI issues

**subject 410012 timepoint 02** -> scan was blacklisted "aborted" for system failure..no DWI for this participant

**subject 220009_timepoint 01** -> scan was also incomplete (this participant was only able complete the T1w)

So we will filter the data table to exclude these 2 participants (final n=71)


```r
df <- filter(df, !(STUDYID %in% c("410012", "220009")))
```

## mangling the Mean Diffusivity cata data

Erin reran the enigma DTI pipeline for only PMC using a different skull stripping parameter (-fa 0.7 to BET). We will use these numbers instead of the others in the archive here..


```r
#bring in MD data (from the filesystem)
MD_most <- read_csv('../data/enigma-DTI_archive_201811/enigmaDTI-MD-results.csv')
MD_PMC <- read_csv('../data/enigma-DTI_PMCredo_201809/enigmaDTI-MD-results.csv')

# separate id into it's parts and then drop old PMC data
MD_most <- MD_most %>%
  separate(id, into = c("study", "site", "STUDYID", "timepoint")) %>%
  filter(site != "PMC")

# separate the PMC subject id into it's parts and then bind to the data from the other sites 
MD <- MD_PMC %>%
  separate(id, into = c("study", "site", "STUDYID", "timepoint")) %>%
  bind_rows(MD_most)

# drop acute ("00") and other ("03") timepoints from the analysis
MD <- MD %>% 
  filter(!(timepoint %in% c("00", "03"))) %>%
  gather(tract, MD, ends_with("MD")) %>%
  unite(tract_timepoint, tract, timepoint) %>%
  spread(tract_timepoint, MD)
```


## check for missing MD data


```r
# filter the master spreadsheet for the list of completers (no output means we are ok)
df %>%
  anti_join(MD, by = "STUDYID") %>%
  summarise(`Number of missing MD values` = n()) %>%
  knitr::kable()
```


\begin{tabular}{r}
\hline
Number of missing MD values\\
\hline
0\\
\hline
\end{tabular}

## merge (i.e. join) the MD data with the clinical scores 


```r
all_MD <- df %>%
  select(STUDYID, sex, age, randomization, category, dateDiff) %>%
  left_join(MD, by = "STUDYID")

all_MD %>%
  filter(is.na(AverageFA_MD_01)) %>%
  summarise(`Number of missing timepoint 1 MD values` = n()) %>%
  knitr::kable()
```


\begin{tabular}{r}
\hline
Number of missing timepoint 1 MD values\\
\hline
0\\
\hline
\end{tabular}

```r
all_MD %>%
  filter(is.na(AverageFA_MD_02)) %>%
  summarise(`Number of missing timepoint 2 MD values` = n()) %>%
  knitr::kable()
```


\begin{tabular}{r}
\hline
Number of missing timepoint 2 MD values\\
\hline
0\\
\hline
\end{tabular}


```r
#write out clean MD speadsheet (required for subsequent MD analyses)
write.csv(all_MD, '../generated_csvs/STOPPD_MDclean.csv', row.names = FALSE)
```





## RCT only


```r
#boxplot of difference in MD in whole skeleton (y axis) by randomization group (x axis)
ggplot(RCT_MD, aes(x= randomization, y = diffAverageSkel_MD)) + 
   geom_boxplot(outlier.shape = NA) + 
   geom_dotplot(binaxis = 'y', stackdir = 'center') +
   geom_hline(yintercept = 0) +
   ggtitle("Whole skeleton mean diffusivity") +
   xlab("randomization condition") +  
   ylab("difference between timepoints") +
   theme_minimal()
```

```
## `stat_bindot()` using `bins = 30`. Pick better value with `binwidth`.
```

![](09_STOPPD_MD-meanFAskel_files/figure-latex/RCT_MD_meanSkel_plot-1.pdf)<!-- --> 



```r
fit_rct <- lm(diffAverageSkel_MD ~ randomization, data= RCT_MD)
print(fit_rct)
```

```
## 
## Call:
## lm(formula = diffAverageSkel_MD ~ randomization, data = RCT_MD)
## 
## Coefficients:
##    (Intercept)  randomizationP  
##     0.00002180     -0.00002586
```

```r
summary(fit_rct)
```

```
## 
## Call:
## lm(formula = diffAverageSkel_MD ~ randomization, data = RCT_MD)
## 
## Residuals:
##          Min           1Q       Median           3Q          Max 
## -0.000074955 -0.000016010  0.000001087  0.000028189  0.000048102 
## 
## Coefficients:
##                    Estimate   Std. Error t value Pr(>|t|)   
## (Intercept)     0.000021795  0.000006535   3.335  0.00191 **
## randomizationP -0.000025858  0.000011047  -2.341  0.02459 * 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.00003332 on 38 degrees of freedom
## Multiple R-squared:  0.126,	Adjusted R-squared:  0.103 
## F-statistic: 5.479 on 1 and 38 DF,  p-value: 0.02459
```

```r
#run linear model with covariates of sex and age
fit_rct <- lm(diffAverageSkel_MD ~ randomization + sex + age, data= RCT_MD)
print(fit_rct)
```

```
## 
## Call:
## lm(formula = diffAverageSkel_MD ~ randomization + sex + age, 
##     data = RCT_MD)
## 
## Coefficients:
##    (Intercept)  randomizationP            sexM             age  
##  0.00001593673  -0.00002622481   0.00000257258   0.00000008944
```

```r
summary(fit_rct)
```

```
## 
## Call:
## lm(formula = diffAverageSkel_MD ~ randomization + sex + age, 
##     data = RCT_MD)
## 
## Residuals:
##          Min           1Q       Median           3Q          Max 
## -0.000078824 -0.000015346  0.000001442  0.000027004  0.000051108 
## 
## Coefficients:
##                      Estimate     Std. Error t value Pr(>|t|)  
## (Intercept)     0.00001593673  0.00002145081   0.743   0.4623  
## randomizationP -0.00002622481  0.00001152451  -2.276   0.0289 *
## sexM            0.00000257258  0.00001109389   0.232   0.8179  
## age             0.00000008944  0.00000039787   0.225   0.8234  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.00003417 on 36 degrees of freedom
## Multiple R-squared:  0.1292,	Adjusted R-squared:  0.05661 
## F-statistic:  1.78 on 3 and 36 DF,  p-value: 0.1684
```

```r
#run linear model with covariates of sex, age and site
fit_rct <- lm(diffAverageSkel_MD ~ randomization + sex + age + site, data= RCT_MD)
print(fit_rct)
```

```
## 
## Call:
## lm(formula = diffAverageSkel_MD ~ randomization + sex + age + 
##     site, data = RCT_MD)
## 
## Coefficients:
##    (Intercept)  randomizationP            sexM             age  
##   0.0000015270   -0.0000284379    0.0000026363    0.0000003261  
##        siteMAS         siteNKI         sitePMC  
##   0.0000081404    0.0000119016   -0.0000128742
```

```r
summary(fit_rct)
```

```
## 
## Call:
## lm(formula = diffAverageSkel_MD ~ randomization + sex + age + 
##     site, data = RCT_MD)
## 
## Residuals:
##          Min           1Q       Median           3Q          Max 
## -0.000072064 -0.000010679  0.000000839  0.000020198  0.000049068 
## 
## Coefficients:
##                     Estimate    Std. Error t value Pr(>|t|)  
## (Intercept)     0.0000015270  0.0000244528   0.062   0.9506  
## randomizationP -0.0000284379  0.0000119565  -2.378   0.0233 *
## sexM            0.0000026363  0.0000114702   0.230   0.8196  
## age             0.0000003261  0.0000004465   0.730   0.4703  
## siteMAS         0.0000081404  0.0000152481   0.534   0.5970  
## siteNKI         0.0000119016  0.0000145722   0.817   0.4199  
## sitePMC        -0.0000128742  0.0000179022  -0.719   0.4771  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.00003478 on 33 degrees of freedom
## Multiple R-squared:  0.1733,	Adjusted R-squared:  0.02303 
## F-statistic: 1.153 on 6 and 33 DF,  p-value: 0.3545
```

## RCT & Relapse (with time as factor)



```r
RCTRelapse_wholeskelMD <- RCTRelapse_MD %>%
  filter(Tract == "AverageFA")
#plot
RCTRelapse_wholeskelMD %>%
  ggplot(aes(x=model_days, y=MD, colour=randomization)) + 
  geom_point() + 
  geom_line(aes(group=STUDYID), alpha = 0.5) + 
  geom_smooth(method="lm", formula=y~poly(x,1)) +
  ggtitle("Whole skeleton mean diffusivity over time") +    
  xlab("days between MRIs") +  
  ylab("Mean Diffusivity") +
  theme_minimal()
```

![](09_STOPPD_MD-meanFAskel_files/figure-latex/RCTRelapse_MD_plot-1.pdf)<!-- --> 


```r
#run mixed linear model, with covariates
fit_all <- lmer(MD ~ randomization*model_days + sex + age + (1|STUDYID), data= RCTRelapse_wholeskelMD)
summary(fit_all)
```

```
## Linear mixed model fit by REML. t-tests use Satterthwaite's method [
## lmerModLmerTest]
## Formula: MD ~ randomization * model_days + sex + age + (1 | STUDYID)
##    Data: RCTRelapse_wholeskelMD
## 
## REML criterion at convergence: -2207.3
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -1.80780 -0.44415 -0.02353  0.38354  1.76631 
## 
## Random effects:
##  Groups   Name        Variance        Std.Dev.  
##  STUDYID  (Intercept) 0.0000000160882 0.00012684
##  Residual             0.0000000004334 0.00002082
## Number of obs: 142, groups:  STUDYID, 71
## 
## Fixed effects:
##                                 Estimate     Std. Error             df
## (Intercept)                0.00096997852  0.00005883295 67.24042295176
## randomizationP            -0.00006889045  0.00003058032 68.37097299833
## model_days                 0.00000008709  0.00000002198 69.19446523698
## sexM                       0.00003079208  0.00003052508 66.99217346591
## age                        0.00000802914  0.00000099148 66.99260766274
## randomizationP:model_days -0.00000009395  0.00000003705 69.48340161813
##                           t value             Pr(>|t|)    
## (Intercept)                16.487 < 0.0000000000000002 ***
## randomizationP             -2.253             0.027486 *  
## model_days                  3.963             0.000178 ***
## sexM                        1.009             0.316726    
## age                         8.098       0.000000000016 ***
## randomizationP:model_days  -2.536             0.013471 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##             (Intr) rndmzP mdl_dy sexM   age   
## randomiztnP -0.205                            
## model_days  -0.043  0.075                     
## sexM        -0.174  0.050  0.002              
## age         -0.899 -0.061  0.004 -0.085       
## rndmztnP:m_  0.024 -0.099 -0.593  0.002 -0.001
```
## just wanna through in one site model..


```r
#run mixed linear model, with covariates
fit_all <- lmer(MD ~ randomization*model_days + sex + age + site + (1|STUDYID), data= RCTRelapse_wholeskelMD)
summary(fit_all)
```

```
## Linear mixed model fit by REML. t-tests use Satterthwaite's method [
## lmerModLmerTest]
## Formula: 
## MD ~ randomization * model_days + sex + age + site + (1 | STUDYID)
##    Data: RCTRelapse_wholeskelMD
## 
## REML criterion at convergence: -2201.2
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -1.76367 -0.44166 -0.00876  0.39208  1.91515 
## 
## Random effects:
##  Groups   Name        Variance        Std.Dev.  
##  STUDYID  (Intercept) 0.0000000077233 0.00008788
##  Residual             0.0000000004336 0.00002082
## Number of obs: 142, groups:  STUDYID, 71
## 
## Fixed effects:
##                                 Estimate     Std. Error             df
## (Intercept)                0.00107616983  0.00004312397 64.39556122315
## randomizationP            -0.00003551473  0.00002183608 66.56430055822
## model_days                 0.00000008624  0.00000002197 69.34666962025
## sexM                       0.00005950979  0.00002160794 63.94765683051
## age                        0.00000761020  0.00000069842 63.95027065884
## siteMAS                   -0.00019539464  0.00002789578 63.94948973534
## siteNKI                   -0.00018424524  0.00003016377 63.95445709082
## sitePMC                   -0.00018719886  0.00003103365 63.94534349730
## randomizationP:model_days -0.00000009587  0.00000003699 69.94739066144
##                           t value             Pr(>|t|)    
## (Intercept)                24.955 < 0.0000000000000002 ***
## randomizationP             -1.626             0.108585    
## model_days                  3.926             0.000201 ***
## sexM                        2.754             0.007655 ** 
## age                        10.896 0.000000000000000325 ***
## siteMAS                    -7.004 0.000000001833884447 ***
## siteNKI                    -6.108 0.000000066268061845 ***
## sitePMC                    -6.032 0.000000089508213317 ***
## randomizationP:model_days  -2.592             0.011617 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##             (Intr) rndmzP mdl_dy sexM   age    sitMAS sitNKI sitPMC
## randomiztnP -0.137                                                 
## model_days  -0.059  0.105                                          
## sexM        -0.126  0.072  0.003                                   
## age         -0.879 -0.077  0.006 -0.086                            
## siteMAS     -0.290 -0.174  0.004 -0.092  0.124                     
## siteNKI     -0.175 -0.122 -0.008 -0.122  0.013  0.355              
## sitePMC     -0.153 -0.092  0.000 -0.146 -0.007  0.341  0.320       
## rndmztnP:m_  0.032 -0.139 -0.594  0.001 -0.002  0.001  0.007  0.002
```



```md
#cleanup
rm('df', 'fit_all', 'fit_rct', 'MD', 'plot', 'RCT_FA', 'RCTRelapse_FA')
```

